#!/usr/bin/env bash
set -euo pipefail

# Nerd Fonts installation

log() {
  echo "[fonts] $*"
}

os_name="$(uname -s)"
FONT_NAME="JetBrainsMono"

if [[ "$os_name" == "Darwin" ]]; then
  log "Installing $FONT_NAME Nerd Font (brew)"
  brew install --cask font-jetbrains-mono-nerd-font

elif [[ "$os_name" == "Linux" ]]; then
  FONT_DIR="$HOME/.local/share/fonts"

  if fc-list | grep -qi "JetBrainsMono"; then
    log "$FONT_NAME Nerd Font already installed"
    exit 0
  fi

  log "Installing $FONT_NAME Nerd Font"

  # Get latest release URL
  FONT_URL="https://github.com/ryanoasis/nerd-fonts/releases/latest/download/JetBrainsMono.zip"

  tmpdir="$(mktemp -d)"
  curl -fsSL "$FONT_URL" -o "$tmpdir/font.zip"

  mkdir -p "$FONT_DIR"
  unzip -q "$tmpdir/font.zip" -d "$FONT_DIR/JetBrainsMono"

  rm -rf "$tmpdir"

  # Refresh font cache
  log "Refreshing font cache"
  fc-cache -fv > /dev/null

  log "Done - set 'JetBrainsMono Nerd Font' in your terminal"
fi
