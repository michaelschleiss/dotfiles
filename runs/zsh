#!/usr/bin/env bash
set -euo pipefail
source "$(dirname "$0")/lib"

log() {
  echo "[zsh] $*"
}

os_name="$(uname -s)"

# --- Install zsh + plugins (Linux only, macOS has zsh built-in) ---
if [[ "$os_name" == "Linux" ]]; then
  log "Installing zsh and plugins"
  sudo apt-get update -qq
  sudo apt-get install -qq -y zsh zsh-syntax-highlighting
fi

# --- Set zsh as default shell ---
current_shell="$(basename "$SHELL")"
if [[ "$current_shell" != "zsh" ]]; then
  log "Setting zsh as default shell"
  chsh -s "$(which zsh)"
else
  log "zsh already default shell"
fi

# --- Source .zsh_profile from .zshrc ---
touch "$HOME/.zshrc"
add_block_to_file "$HOME/.zshrc" "zsh-profile" '[[ -f ~/.zsh_profile ]] && source ~/.zsh_profile'

log "Done - restart terminal or run: exec zsh"
