#!/usr/bin/env bash
set -euo pipefail

rm -rf ~/neovim
echo "Cloning neovim repository..."
git clone -q git@github.com:neovim/neovim.git ~/neovim
cd ~/neovim
git fetch -q
git checkout -q v0.11.5

os_name="$(uname -s)"

if [[ "$os_name" == "Darwin" ]]; then
  brew install ninja cmake gettext curl
  cores=$(sysctl -n hw.ncpu)
elif [[ "$os_name" == "Linux" ]]; then
  echo "Updating package lists..."
  sudo apt-get update -qq
  echo "Installing build dependencies..."
  sudo apt-get install -qq cmake gettext lua5.1 liblua5.1-0-dev
  echo "Installing plugin dependencies..."
  sudo apt-get install -qq cargo luarocks golang ripgrep fd-find
  ln -sf $(which fdfind) ~/.local/bin/fd
  cores=$(nproc)
else
  echo "Unknown OS: $os_name" > $2
  exit 1
fi

make CMAKE_BUILD_TYPE=RelWithDebInfo -j${cores}
sudo make install

rm -rf ~/neovim

# Install some post dependencies



